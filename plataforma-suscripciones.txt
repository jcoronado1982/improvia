ARQUITECTURA DE LA PLATAFORMAPlataforma de Suscripciones para Creadores de ContenidoWordPress · MU-Plugins · Next.js · React · WPGraphQL · StripeDescripción del Negocio→  Un creador (entrenador, coach, atleta, profesional) publica planes, programas o contenido exclusivo.→  Un suscriptor se registra, elige un plan y paga una suscripción recurrente vía Stripe.→  El acceso al contenido se habilita o bloquea automáticamente según el estado de la suscripción.→  No es un e-commerce de productos físicos: no hay inventario, envíos ni carrito de compras.1. Modelo de Negocio y ActoresLa plataforma conecta dos tipos de usuario con roles y permisos distintos. Toda la lógica de acceso, pagos y contenido gira alrededor de esta relación.1.1 Actores del SistemaActorResponsabilidadEjemplo RealCreadorPublica contenido, define planes y precios, gestiona suscriptores.Entrenador, coach, atleta, profesional.SuscriptorSe registra, elige un plan, paga mensual o anual y accede al contenido.Jugador de fútbol, alumno, fan.AdministradorGestiona la plataforma, modera creadores y supervisa pagos.Equipo interno de la empresa.1.2 Flujo Principal del NegocioPasoDescripciónPaso 1El creador crea su perfil y publica uno o más planes de suscripción con precio y descripción.Paso 2El suscriptor descubre el perfil del creador y elige un plan.Paso 3El suscriptor completa el pago recurrente vía Stripe Checkout.Paso 4Stripe confirma el pago y WordPress habilita el acceso automáticamente.Paso 5El suscriptor accede al contenido exclusivo mientras la suscripción esté activa.Paso 6Si el pago falla o se cancela, el acceso se revoca automáticamente vía Stripe Webhook.1.3 Tipos de Contenido que puede publicar un CreadorSesiones de entrenamiento individuales o grupales (video, PDF, texto).Programas estructurados por semanas o meses.Acceso a calendario de clases en vivo.Mensajería directa con el creador.Recursos descargables exclusivos para suscriptores.2. Stack TecnológicoLa plataforma se divide en dos proyectos independientes: un backend en WordPress y un frontend en Next.js. Se comunican exclusivamente a través de WPGraphQL.TecnologíaRol en la PlataformaWordPress 6.xCMS y motor central del backend. Gestiona usuarios, contenido y roles.MU-PluginsArquitectura modular custom. Toda la lógica de negocio vive aquí.ACF ProCampos personalizados para perfiles de creadores y planes de suscripción.WPGraphQLAPI GraphQL que expone los datos de WordPress al frontend Next.js.WPGraphQL ACFIntegración que expone los campos ACF en el schema de GraphQL.StripeProcesador de pagos recurrentes. Maneja suscripciones, facturas y webhooks.WP Stripe GatewayPlugin que conecta Stripe con WordPress para gestionar estados de suscripción.Next.js 14+Framework del frontend. Maneja routing, SSR y build de la aplicación.React 18Librería de componentes para toda la interfaz de usuario.Apollo ClientCliente GraphQL en React para consumir datos de WPGraphQL.CSS Subgrid + BEMSistema de layout y nomenclatura CSS para los formularios y componentes UI.JWT AuthenticationAutenticación sin estado entre el frontend Next.js y el backend WordPress.¿Por qué NO WooCommerce?→  WooCommerce está diseñado para vender productos físicos o digitales con transacciones únicas.→  Este modelo de negocio es de suscripciones recurrentes: Stripe lo maneja de forma nativa y más simple.→  Usar WooCommerce añadiría complejidad innecesaria (carrito, inventario, órdenes) que no aplica aquí.→  Stripe + WordPress directo es la arquitectura estándar para plataformas de membresías y suscripciones.3. Arquitectura Backend — MU-PluginsToda la lógica de negocio custom vive en MU-Plugins con una estructura modular donde cada módulo tiene una única responsabilidad. La arquitectura sigue el patrón de módulos y componentes similar a frameworks modernos como React o Angular.3.1 Principio de DiseñoReglas del Backend→  Un archivo = una responsabilidad. Ningún archivo supera las 100 líneas.→  Un módulo por dominio: usuarios, suscripciones, contenido, pagos, formularios.→  La lógica de negocio nunca vive en el tema ni en functions.php.→  Los campos ACF se definen por código en MU-Plugins, no desde la interfaz de WordPress.→  Todo el código custom es versionable en Git sin depender de la base de datos.3.2 Módulos del BackendMóduloResponsabilidadDetalleCoreAutoloader, hooks globales y helpers compartidos.Base de todos los módulos.UsersRegistro custom, roles (creador / suscriptor) y perfiles.CPT Creador + ACF de perfil.SubscriptionsGestión del estado de suscripción por usuario.Activa, cancelada, vencida.PlansDefinición de planes con precio, duración y beneficios.CPT Plan + ACF de plan.ContentPublicación de sesiones, programas y recursos del creador.CPTs de contenido + acceso.PaymentsIntegración con Stripe: webhooks, sincronización de estados.Manejo de eventos de Stripe.Access ControlLógica que decide si un suscriptor puede ver un contenido.Filtros de acceso global.FormsFormularios personalizados: registro, contacto, onboarding.Componentes PHP reutilizables.APIMutations y queries GraphQL custom expuestas vía WPGraphQL.Endpoints de la plataforma.3.3 Custom Post Types (CPT)CPTDescripcióncreatorPerfil público de cada creador con su información, foto y descripción.planPlanes de suscripción: nombre, precio, duración, beneficios incluidos.subscriptionRegistro de cada suscripción activa o histórica de un usuario.sessionSesión de entrenamiento o clase publicada por un creador.programPrograma estructurado que agrupa múltiples sesiones.resourceArchivo descargable o material exclusivo para suscriptores.3.4 Roles y Permisos de WordPressRolCapacidadesadministratorAcceso total a la plataforma. Gestiona creadores y modera contenido.creatorPublica contenido, define planes, ve sus suscriptores y métricas.subscriberRol base de WordPress, extendido con el estado de suscripción activa.pendingUsuario registrado pero que aún no ha completado el pago inicial.4. Integración con StripeStripe es el único procesador de pagos de la plataforma. Maneja los cobros recurrentes, los intentos fallidos, las cancelaciones y los reembolsos. WordPress reacciona a los eventos de Stripe a través de webhooks.4.1 Flujo de PagoEventoAcción1. Selección de planEl suscriptor elige un plan desde el frontend Next.js.2. Sesión de StripeEl backend WordPress crea una Stripe Checkout Session con el precio del plan.3. Redirect a StripeEl usuario es redirigido a la página de pago oficial de Stripe (hosted).4. Pago completadoStripe procesa el pago y redirige al usuario de vuelta a la plataforma.5. Webhook de StripeStripe envía un evento al endpoint de WordPress confirmando el pago.6. Acceso habilitadoEl módulo Payments de WordPress activa la suscripción del usuario.7. Renovación automáticaStripe cobra automáticamente en la siguiente fecha de renovación.8. Fallo de pagoStripe notifica el fallo, WordPress suspende el acceso hasta que se regularice.4.2 Eventos de Stripe que escucha WordPressEvento de StripeAcción en WordPresscheckout.session.completedActiva la suscripción del usuario y habilita el acceso al contenido.invoice.payment_succeededConfirma la renovación exitosa y extiende la fecha de vencimiento.invoice.payment_failedMarca la suscripción como en gracia y notifica al usuario.customer.subscription.deletedCancela la suscripción y revoca el acceso al contenido exclusivo.customer.subscription.updatedSincroniza cambios de plan (upgrade o downgrade) en WordPress.Stripe Checkout Hosted vs Custom→  Se usa Stripe Checkout Hosted: Stripe muestra su propia página de pago.→  Ventaja: cumplimiento PCI-DSS automático, sin necesidad de manejar datos de tarjeta en el servidor.→  El frontend Next.js nunca toca datos de tarjetas de crédito directamente.→  Para personalización visual se puede usar Stripe Elements en el frontend si se requiere en el futuro.5. Arquitectura Frontend — Next.js + ReactEl frontend es una aplicación Next.js completamente separada del backend WordPress. Consume todos los datos vía WPGraphQL y maneja la autenticación con JWT. Next.js aporta SSR para las páginas públicas de creadores y React maneja toda la interactividad.5.1 Secciones de la AplicaciónSecciónPropósitoConsideracionesPúblicaPáginas de descubrimiento de creadores y planes.Sin login requerido. Con SSR para SEO.AutenticaciónRegistro, login y recuperación de contraseña.Formularios React conectados al backend.SuscriptorDashboard del suscriptor: contenido activo y gestión de plan.Área privada protegida por JWT.CreadorPanel del creador: publicar contenido, ver métricas.Área privada con rol verificado.PagoRedirección a Stripe Checkout y página de confirmación.Manejado mayormente por Stripe.5.2 Páginas PrincipalesRutaDescripción/ (Home)Listado de creadores destacados. SSR para SEO./creador/[slug]Perfil público del creador con sus planes. SSR./creador/[slug]/plan/[id]Detalle del plan con precio y beneficios. SSR./registroFormulario de registro como suscriptor o creador./loginFormulario de autenticación./dashboardPanel del suscriptor: contenido activo disponible./dashboard/suscripcionGestión de plan activo: cancelar, cambiar, ver historial./creador/panelPanel privado del creador para publicar y gestionar./pago/confirmacionPágina de éxito después de completar el pago en Stripe./pago/canceladoPágina cuando el usuario abandona el proceso de pago.5.3 Componentes del FrontendLos componentes siguen una estructura de dos niveles: componentes compartidos reutilizables en toda la app, y componentes de feature específicos de cada sección.ComponentePropósitoUsado enShared / InputCampo de texto reutilizable con validación y manejo de errores.Usado en todos los formularios.Shared / SelectCampo de selección con opciones dinámicas.Formularios y filtros.Shared / FileUploadSubida de archivos con preview y validación de tipo y tamaño.Perfil de creador, recursos.Shared / SubmitButtonBotón con estado de carga y feedback visual.Todos los formularios.Shared / PlanCardTarjeta que muestra un plan de suscripción con precio y CTA.Perfil del creador, home.Shared / ContentCardTarjeta de sesión o programa con thumbnail y acceso restringido.Dashboard del suscriptor.Forms / RegisterFormFormulario de registro completo con validación.Página /registro.Forms / LoginFormFormulario de login con manejo de errores.Página /login.Forms / CreatorOnboardingFormulario multi-paso para configurar perfil de creador.Onboarding de creadores.5.4 Comunicación con el BackendTipo de OperaciónMecanismoLectura de datosApollo Client con WPGraphQL. Una sola query trae exactamente los datos necesarios.AutenticaciónMutation de login vía WPGraphQL retorna un JWT. Se almacena en memoria (no localStorage).Envío de formulariosMutations de WPGraphQL para registro, actualización de perfil y otras acciones.Inicio de pagoEl frontend solicita al backend la URL de Stripe Checkout y redirige al usuario.Estado de suscripciónQuery GraphQL que retorna el estado actual de la suscripción del usuario autenticado.Webhooks de StripeStripe llama directamente al backend WordPress. El frontend no interviene.6. Sistema de Formularios PersonalizadosLos formularios son el corazón de la experiencia de usuario. Se implementan como componentes React en el frontend con validación en cliente, y su lógica de procesamiento vive en el módulo Forms del backend MU-Plugins.6.1 Formularios de la PlataformaFormularioCampos PrincipalesContextoRegistro de SuscriptorNombre, email, contraseña, aceptar términos.Validación en cliente + servidor.Registro de CreadorDatos personales, especialidad, foto de perfil.Multi-paso con FileUpload.Onboarding de CreadorConfigurar plan, precio, descripción, primer contenido.Multi-paso con 4 pasos.Publicar SesiónTítulo, descripción, archivo de video o PDF, visibilidad.Creador autenticado.Publicar ProgramaNombre, semanas, asociar sesiones existentes.Creador autenticado.Editar PerfilFoto, bio, redes sociales, especialidades.Creador y suscriptor.Contacto / SoporteAsunto, mensaje, adjuntos opcionales.Cualquier usuario.6.2 Arquitectura de un FormularioCapaResponsabilidadComponente React (.tsx)Solo renderiza la UI. Usa los componentes compartidos de Input, Select, etc.Custom Hook (.ts)Contiene todo el estado, validación y lógica de envío. Separado del componente.Mutation GraphQL (.ts)Define la operación que se envía al backend al hacer submit.Class PHP — ValidatorValida los datos en el servidor antes de procesarlos. Segunda línea de defensa.Class PHP — ServiceContiene la lógica de negocio: guardar, notificar, crear registros.Class PHP — ComponentRegistra el endpoint AJAX o la mutation GraphQL y orquesta Validator y Service.6.3 Layout CSS con SubgridTodos los formularios usan CSS Subgrid para alineación perfecta entre componentes. Los campos pueden ocupar ancho completo o media columna. El layout se controla desde las props del componente, no desde el CSS.Modificador CSSComportamientoform-field--fullEl campo ocupa todo el ancho del formulario (2 columnas). Ej: campo de mensaje.form-field--halfEl campo ocupa media columna. Ej: nombre y apellido en la misma fila.form-field--thirdEl campo ocupa un tercio. Usado en formularios de 3 columnas.7. Control de Acceso al ContenidoEl control de acceso es la pieza más crítica de la plataforma. Determina qué contenido puede ver cada usuario según su suscripción activa. Se implementa en dos niveles: backend y frontend.7.1 Niveles de AccesoNivelCondición de AccesoPúblicoVisible para cualquier visitante. Perfil del creador, descripción de planes.RegistradoRequiere estar logueado pero no suscrito. Vista previa de contenido premium.Suscriptor activoRequiere suscripción activa al creador específico. Acceso completo al contenido.CreadorSolo el creador del contenido puede editarlo o eliminarlo.AdministradorAcceso total a toda la plataforma para moderación.7.2 Dónde se valida el AccesoCapaMecanismoBackend — PHPEl módulo Access Control verifica el rol y suscripción antes de retornar datos en GraphQL.Backend — GraphQLLos resolvers de WPGraphQL verifican permisos antes de exponer el contenido.Frontend — ReactLas rutas privadas verifican el JWT y el estado de suscripción antes de renderizar.Frontend — UIEl componente ContentCard muestra un CTA de suscripción si el contenido está bloqueado.Regla de Seguridad Fundamental→  La validación del frontend es solo visual (UX). NUNCA es la única barrera de seguridad.→  Todo el acceso real se valida en el backend antes de retornar cualquier dato.→  Si alguien omite el frontend y llama al GraphQL directamente, el backend rechaza la petición.8. Infraestructura y Deploys8.1 Separación de ProyectosDominioResponsabilidadapi.plataforma.comWordPress + MU-Plugins. Backend, GraphQL y webhooks de Stripe.plataforma.comNext.js. Frontend público, dashboard de suscriptores y creadores.8.2 Variables de EntornoVariableUsoProyectoNEXT_PUBLIC_GRAPHQL_URLURL del endpoint WPGraphQL.Frontend Next.jsNEXT_PUBLIC_STRIPE_KEYClave pública de Stripe (publishable).Frontend Next.jsSTRIPE_SECRET_KEYClave secreta de Stripe.Backend WordPressSTRIPE_WEBHOOK_SECRETSecreto para validar webhooks de Stripe.Backend WordPressJWT_AUTH_SECRET_KEYSecreto para firmar tokens JWT.Backend WordPressWP_ENVEntorno: development / staging / production.Ambos9. Cómo Escalar la PlataformaAgregar un nuevo tipo de contenidoCrear el CPT correspondiente en el módulo Content del backend.Definir sus campos ACF en la clase de fields correspondiente.Exponer el CPT en WPGraphQL con la anotación correspondiente.Crear el componente React en el frontend y su custom hook.Agregar la ruta en Next.js App Router.No tocar ningún otro módulo existente.Agregar un nuevo formularioCrear el componente React con su custom hook en components/forms/.Crear la mutation GraphQL correspondiente en lib/graphql/queries/.Crear la clase PHP en mu-plugins/modules/forms/ con Validator y Service.Registrar en Forms_Module.php.No tocar ningún formulario existente.Agregar un nuevo plan de suscripciónCrear el producto y precio en el dashboard de Stripe.Publicar el nuevo CPT Plan en WordPress con el Stripe Price ID correspondiente.El frontend lo muestra automáticamente al consultar los planes del creador.No requiere cambios de código.10. Convenciones del EquipoElementoConvenciónClases PHPPascalCase con guión bajo: Input_Component, Contact_Validator.Archivos PHPkebab-case prefijado: class-input-component.php, class-forms-module.php.Componentes ReactPascalCase en carpeta propia: ContactForm/ContactForm.tsx.Custom Hooks ReactcamelCase con prefijo use: useContactForm.ts, useSubscription.ts.Queries GraphQLPascalCase descriptivo: GetCreatorPlans, SubmitContactForm.Clases CSS (BEM)Bloque__elemento--modificador: form-field__input--error.Variables CSSKebab-case con doble guión: --form-gap, --input-radius, --color-primary.CPTs de WordPressSingular en minúsculas: creator, plan, session, program.Commits de GitConvención Angular: feat/fix/refactor(scope): descripción breve.Ramas de Gitfeature/nombre-feature, fix/nombre-bug, release/v1.x.x.Documento de Arquitectura v1.0 — Para uso interno del equipo de desarrollo. Actualizar ante cambios arquitectónicos mayores.